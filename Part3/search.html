<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Search Page</title>
	<link rel="stylesheet" href="css/styles.css">
	<style>
		.error {
		  color: red;
		  font-weight: bold;
		}
	</style>
</head>

<body>
	<header>
		<h1>Funny Fund Search Page</h1>
	</header>


	<body>
		<div id="searchForm">
		  <label for="organizer">Organizer:</label>
		  <input type="text" id="organizer" name="organizer">
		
		  <label for="city">City:</label>
		  <input type="text" id="city" name="city">
		
		  <label for="category">Category:</label>
		  <input id="category" name="category">
		
		  <button class="button" type="button" id="searchButton" onclick="onClick_Search()">Search</button>
		  <button class="button" type="button" id="clearButton" onclick="clearChechboxes()">Clear</button>
		</div>
		<br>
		
		<div id="forms-container"></div>
		<div id="error-message" class="error" style="display: none;">No fundraisers found.</div>

	<footer>
		<!-- footer -->
		<p>&copy; 2024 Funny Fund</p>
	</footer>

	<!-- 可以在这里链接JavaScript文件 -->
	<script src="/js/script.js"></script>
	<script>
		//clear boxes	
		function clearChechboxes() {
			document.getElementById('category').value = '';
			document.getElementById('organizer').value = '';
			document.getElementById('city').value = '';
		}
	
		function onClick_Search() {
			var organizer = document.getElementById('organizer').value;
			var city = document.getElementById('city').value;
			var category = document.getElementById('category').value;
			
			// Check if at least one field is filled
			if (!organizer && !city && !category) {
				alert('You must select at least one search criteria.');
				return;
			}

			// Construct the query string
			var queryString = '?';
			if (organizer) queryString += 'organizer=' + encodeURIComponent(organizer) + '&';
			if (city) queryString += 'city=' + encodeURIComponent(city) + '&';
			if (category) queryString += 'category=' + encodeURIComponent(category);
			
			// Remove the last '&' if it exists
			if (queryString.endsWith('&')) {
				queryString = queryString.slice(0, -1);
			}

			fetch('/search' + queryString)
			.then(response => response.json())
			.then(data => {
			if (data.length === 0) {
				document.getElementById('error-message').style.display = 'block';
				document.getElementById('results').innerHTML = '';
			} else {
				document.getElementById('error-message').style.display = 'none';
				displayResults(data);
			}
			})
			.catch(error => console.error('Error:', error));
		}


		function displayResults(data) {
			
			// 遍历数据并创建表单
			data.forEach(item => {
				// 创建表单元素
				const form = document.createElement('form');
				form.innerHTML = `
					<div class="result">
						<div class="text"> 
							<label for="organizer">organizer:</label>
							<label>${item.ORGANIZER}</label><br>
							
							<label for="caption">caption:</label>
							<label>${item.CAPTION}</label><br>
							
							<label for="target">target funding:</label>
							<label>${item.TARGET_FUNDING}</label><br>

							<label for="current">current funding:</label>
							<label>${item.CURRENT_FUNDING}</label><br>

							<label for="city">city:</label>
							<label>${item.CITY}</label><br>

							<label for="category">category:</label>
							<a href="/search?category=${item.CATEGORY_NAME}" class="category-link">${item.CATEGORY_NAME}</a><br><br><br>

							<hr class="separator">
						</div>
					</div>
				
				`;
				// 将表单添加到容器中
				document.getElementById('forms-container').appendChild(form);
			});
 		}
  
	</script>
</body>

</html>